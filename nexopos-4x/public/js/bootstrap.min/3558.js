"use strict";(self.webpackChunkNexoPOS_4x=self.webpackChunkNexoPOS_4x||[]).push([[3558,4864],{5834:(t,e,s)=>{s.d(e,{Z:()=>r});const o={name:"ns-paginate",props:["pagination"],data:function(){return{page:1,path:""}},mounted:function(){this.path=this.pagination.path},computed:{getPagination:function(){return this.pagination?this.pageNumbers(this.pagination.last_page,this.pagination.current_page):[]}},methods:{gotoPage:function(t){this.page=t,this.$emit("load","".concat(this.path,"?page=").concat(this.page))},pageNumbers:function(t,e){var s=[];e-3>1&&s.push(1,"...");for(var o=1;o<=t;o++)e+3>o&&e-3<o&&s.push(o);return e+3<t&&s.push("...",t),console.log(s),s.filter((function(t){return t>0||"string"==typeof t}))}}};const r=(0,s(1900).Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex -mx-1",attrs:{id:"pagination"}},[t.pagination.current_page?[s("a",{staticClass:"mx-1 flex items-center justify-center h-8 w-8 rounded-full bg-gray-200 text-gray-700 hover:bg-blue-400 hover:text-white shadow",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.gotoPage(t.pagination.first_page)}}},[s("i",{staticClass:"las la-angle-double-left"})]),t._v(" "),t._l(t.getPagination,(function(e,o){return["..."!==t.page?s("a",{key:o,staticClass:"mx-1 flex items-center justify-center h-8 w-8 rounded-full hover:bg-blue-400 hover:text-white",class:t.page==e?"bg-blue-400 text-white":"bg-gray-200 text-gray-700",attrs:{href:"javascript:void(0)"},on:{click:function(s){return t.gotoPage(e)}}},[t._v(t._s(e))]):t._e(),t._v(" "),"..."===t.page?s("a",{key:o,staticClass:"mx-1 flex items-center justify-center h-8 w-8 rounded-full bg-gray-200 text-gray-700",attrs:{href:"javascript:void(0)"}},[t._v("...")]):t._e()]})),t._v(" "),s("a",{staticClass:"mx-1 flex items-center justify-center h-8 w-8 rounded-full bg-gray-200 text-gray-700 hover:bg-blue-400 hover:text-white shadow",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.gotoPage(t.pagination.last_page)}}},[s("i",{staticClass:"las la-angle-double-right"})])]:t._e()],2)}),[],!1,null,null,null).exports},3558:(t,e,s)=>{s.r(e),s.d(e,{default:()=>a});var o=s(2242),r=s(7298);const n={name:"ns-pos-customers-button",methods:{__:s(7389).__,openPendingOrdersPopup:function(){(new o.G).open(r.Z)}}};const a=(0,s(1900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm",on:{click:function(e){return t.openPendingOrdersPopup()}}},[s("i",{staticClass:"mr-1 text-xl lar la-user-circle"}),t._v(" "),s("span",[t._v(t._s(t.__("Customers")))])])}),[],!1,null,null,null).exports},4864:(t,e,s)=>{s.r(e),s.d(e,{default:()=>r});const o={data:function(){return{title:"",message:""}},computed:{size:function(){return this.$popupParams.size||"h-full w-full"}},mounted:function(){var t=this;this.title=this.$popupParams.title,this.message=this.$popupParams.message,this.$popup.event.subscribe((function(e){"click-overlay"===e.event&&(t.$popupParams.onAction(!1),t.$popup.close())}))},methods:{__:s(7389).__,emitAction:function(t){this.$popupParams.onAction(t),this.$popup.close()}}};const r=(0,s(1900).Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex flex-col shadow-lg w-5/7-screen md:w-4/7-screen lg:w-2/7-screen",class:t.size,attrs:{id:"confirm-popup"}},[s("div",{staticClass:"flex items-center justify-center flex-col flex-auto p-4"},[s("h2",{staticClass:"text-xl md:text-3xl font-body text-center"},[t._v(t._s(t.title))]),t._v(" "),s("p",{staticClass:"py-4 text-sm md:text-base text-center"},[t._v(t._s(t.message))])]),t._v(" "),s("div",{staticClass:"action-buttons flex border-t"},[s("button",{staticClass:"flex-auto w-1/2 h-16 flex items-center justify-center uppercase",on:{click:function(e){return t.emitAction(!0)}}},[t._v(t._s(t.__("Yes")))]),t._v(" "),s("hr",{staticClass:"border-r h-16"}),t._v(" "),s("button",{staticClass:"flex-auto w-1/2 h-16 flex items-center justify-center uppercase",on:{click:function(e){return t.emitAction(!1)}}},[t._v(t._s(t.__("No")))])])])}),[],!1,null,null,null).exports},3258:(t,e,s)=>{s.r(e),s.d(e,{default:()=>u});var o=s(8603),r=s(6386),n=s(9671),a=s(7389),i=s(1045);s(9624);const c={name:"ns-pos-coupons-load-popup",data:function(){return{placeHolder:(0,a.__)("Coupon Code"),couponCode:null,order:null,activeTab:"apply-coupon",orderSubscriber:null,customerCoupon:null}},mounted:function(){var t=this;this.popupCloser(),this.$refs.coupon.select(),this.orderSubscriber=POS.order.subscribe((function(e){t.order=e,t.order.coupons.length>0&&(t.activeTab="active-coupons")})),this.$popupParams&&this.$popupParams.apply_coupon&&(this.couponCode=this.$popupParams.apply_coupon,this.getCoupon(this.couponCode).subscribe({next:function(e){t.customerCoupon=e,t.apply()}}))},destroyed:function(){this.orderSubscriber.unsubscribe()},methods:{__:a.__,popupCloser:o.Z,popupResolver:r.Z,selectCustomer:function(){Popup.show(i.default)},cancel:function(){this.customerCoupon=null,this.couponCode=null},removeCoupon:function(t){this.order.coupons.splice(t,1),POS.refreshCart()},apply:function(){var t=this;try{var e=this.customerCoupon;if(null!==this.customerCoupon.coupon.valid_hours_start&&!ns.date.moment.isAfter(this.customerCoupon.coupon.valid_hours_start)&&this.customerCoupon.coupon.valid_hours_start.length>0)return n.kX.error((0,a.__)("The coupon is out from validity date range.")).subscribe();if(null!==this.customerCoupon.coupon.valid_hours_end&&!ns.date.moment.isBefore(this.customerCoupon.coupon.valid_hours_end)&&this.customerCoupon.coupon.valid_hours_end.length>0)return n.kX.error((0,a.__)("The coupon is out from validity date range.")).subscribe();var s=this.customerCoupon.coupon.products;if(s.length>0){var o=s.map((function(t){return t.product_id}));if(0===this.order.products.filter((function(t){return o.includes(t.product_id)})).length)return n.kX.error((0,a.__)("This coupon requires products that aren't available on the cart at the moment.")).subscribe()}var r=this.customerCoupon.coupon.categories;if(r.length>0){var i=r.map((function(t){return t.category_id}));if(0===this.order.products.filter((function(t){return i.includes(t.$original().category_id)})).length)return n.kX.error((0,a.__)("This coupon requires products that belongs to specific categories that aren't included at the moment.").replace("%s")).subscribe()}this.cancel();var c={active:e.coupon.active,customer_coupon_id:e.id,minimum_cart_value:e.coupon.minimum_cart_value,maximum_cart_value:e.coupon.maximum_cart_value,name:e.coupon.name,type:e.coupon.type,value:0,limit_usage:e.coupon.limit_usage,code:e.coupon.code,discount_value:e.coupon.discount_value,categories:e.coupon.categories,products:e.coupon.products};POS.pushCoupon(c),this.activeTab="active-coupons",setTimeout((function(){t.popupResolver(c)}),500),n.kX.success((0,a.__)("The coupon has applied to the cart.")).subscribe()}catch(t){console.log(t)}},getCouponType:function(t){switch(t){case"percentage_discount":return(0,a.__)("Percentage");case"flat_discount":return(0,a.__)("Flat");default:return(0,a.__)("Unknown Type")}},getDiscountValue:function(t){switch(t.type){case"percentage_discount":return t.discount_value+"%";case"flat_discount":return this.$options.filters.currency(t.discount_value)}},closePopup:function(){this.popupResolver(!1)},setActiveTab:function(t){this.activeTab=t},getCoupon:function(t){return!this.order.customer_id>0?n.kX.error((0,a.__)("You must select a customer before applying a coupon.")).subscribe():n.ih.post("/api/nexopos/v4/customers/coupons/".concat(t),{customer_id:this.order.customer_id})},loadCoupon:function(){var t=this,e=this.couponCode;this.getCoupon(e).subscribe({next:function(e){t.customerCoupon=e,n.kX.success((0,a.__)("The coupon has been loaded.")).subscribe()},error:function(t){n.kX.error(t.message||(0,a.__)("An unexpected error occured.")).subscribe()}})}}};const u=(0,s(1900).Z)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"shadow-lg ns-box w-95vw md:w-3/6-screen lg:w-2/6-screen"},[s("div",{staticClass:"border-b ns-box-header p-2 flex justify-between items-center"},[s("h3",{staticClass:"font-bold"},[t._v(t._s(t.__("Load Coupon")))]),t._v(" "),s("div",[s("ns-close-button",{on:{click:function(e){return t.closePopup()}}})],1)]),t._v(" "),s("div",{staticClass:"p-1 ns-box-body"},[s("ns-tabs",{attrs:{active:t.activeTab},on:{changeTab:function(e){return t.setActiveTab(e)}}},[s("ns-tabs-item",{attrs:{label:t.__("Apply A Coupon"),padding:"p-2",identifier:"apply-coupon"}},[s("div",{staticClass:"border-2 border-info-secondary rounded flex"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.couponCode,expression:"couponCode"}],ref:"coupon",staticClass:"w-full bg-surface-quaternary text-primary p-2 outline-none",attrs:{type:"text",placeholder:t.placeHolder},domProps:{value:t.couponCode},on:{input:function(e){e.target.composing||(t.couponCode=e.target.value)}}}),t._v(" "),s("button",{staticClass:"bg-info-secondary text-white px-3 py-2",on:{click:function(e){return t.loadCoupon()}}},[t._v(t._s(t.__("Load")))])]),t._v(" "),s("div",{staticClass:"pt-2"},[s("p",{staticClass:"p-2 text-center ns-notice-info"},[t._v(t._s(t.__("Input the coupon code that should apply to the POS. If a coupon is issued for a customer, that customer must be selected priorly.")))])]),t._v(" "),t.order&&void 0===t.order.customer_id?s("div",{staticClass:"pt-2",on:{click:function(e){return t.selectCustomer()}}},[s("p",{staticClass:"p-2 cursor-pointer text-center ns-notice-error"},[t._v(t._s(t.__("Click here to choose a customer.")))])]):t._e(),t._v(" "),t.order&&void 0!==t.order.customer_id?s("div",{staticClass:"pt-2"},[s("p",{staticClass:"p-2 text-center ns-notice-success"},[t._v(t._s(t.__("Loading Coupon For : ")+t.order.customer.name+" "+t.order.customer.surname))])]):t._e(),t._v(" "),s("div",{staticClass:"overflow-hidden"},[t.customerCoupon?s("div",{staticClass:"pt-2 fade-in-entrance anim-duration-500 overflow-y-auto h-64"},[s("table",{staticClass:"w-full"},[s("thead",[s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Coupon Name")))]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.customerCoupon.name))])]),t._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Discount"))+" ("+t._s(t.getCouponType(t.customerCoupon.coupon.type))+")")]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.getDiscountValue(t.customerCoupon.coupon)))])]),t._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Usage")))]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.customerCoupon.usage+"/"+(t.customerCoupon.limit_usage||t.__("Unlimited"))))])]),t._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Valid From")))]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.customerCoupon.coupon.valid_hours_start))])]),t._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Valid Till")))]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.customerCoupon.coupon.valid_hours_end))])]),t._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Categories")))]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[s("ul",t._l(t.customerCoupon.coupon.categories,(function(e){return s("li",{key:e.id,staticClass:"rounded-full px-3 py-1 border border-surface-secondary"},[t._v(t._s(e.category.name))])})),0)])]),t._v(" "),s("tr",[s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[t._v(t._s(t.__("Products")))]),t._v(" "),s("td",{staticClass:"p-2 w-1/2 text-primary border border-surface-secondary"},[s("ul",t._l(t.customerCoupon.coupon.products,(function(e){return s("li",{key:e.id,staticClass:"rounded-full px-3 py-1 border border-surface-secondary"},[t._v(t._s(e.product.name))])})),0)])])])])]):t._e()])]),t._v(" "),s("ns-tabs-item",{attrs:{label:t.__("Active Coupons"),padding:"p-1",identifier:"active-coupons"}},[t.order?s("ul",[t._l(t.order.coupons,(function(e,o){return s("li",{key:o,staticClass:"flex justify-between bg-surface-secondary items-center px-2 py-1"},[s("div",{staticClass:"flex-auto"},[s("h3",{staticClass:"font-semibold text-primary p-2 flex justify-between"},[s("span",[t._v(t._s(e.name))]),t._v(" "),s("span",[t._v(t._s(t.getDiscountValue(e)))])])]),t._v(" "),s("div",[s("ns-close-button",{on:{click:function(e){return t.removeCoupon(o)}}})],1)])})),t._v(" "),0===t.order.coupons.length?s("li",{staticClass:"flex justify-between bg-surface-secondary items-center p-2"},[t._v("\n                        No coupons applies to the cart.\n                    ")]):t._e()],2):t._e()])],1)],1),t._v(" "),t.customerCoupon?s("div",{staticClass:"flex"},[s("button",{staticClass:"w-1/2 px-3 py-2 bg-success-primary text-white font-bold",on:{click:function(e){return t.apply()}}},[t._v("\n            "+t._s(t.__("Apply"))+"\n        ")]),t._v(" "),s("button",{staticClass:"w-1/2 px-3 py-2 bg-error-primary text-white font-bold",on:{click:function(e){return t.cancel()}}},[t._v("\n            "+t._s(t.__("Cancel"))+"\n        ")])]):t._e()])}),[],!1,null,null,null).exports},1045:(t,e,s)=>{s.r(e),s.d(e,{default:()=>c});var o=s(9671),r=s(6386),n=s(2242),a=s(7298);const i={data:function(){return{searchCustomerValue:"",orderSubscription:null,order:{},debounceSearch:null,customers:[],isLoading:!1}},computed:{customerSelected:function(){return!1}},watch:{searchCustomerValue:function(t){var e=this;clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout((function(){e.searchCustomer(t)}),500)}},mounted:function(){var t=this;this.$popup.event.subscribe((function(e){"click-overlay"===e.event&&t.resolveIfQueued(!1)})),this.orderSubscription=POS.order.subscribe((function(e){t.order=e})),this.getRecentCustomers(),this.$refs.searchField.focus()},destroyed:function(){this.orderSubscription.unsubscribe()},methods:{__:s(7389).__,resolveIfQueued:r.Z,attemptToChoose:function(){if(1===this.customers.length)return this.selectCustomer(this.customers[0]);o.kX.info("Too many result.").subscribe()},openCustomerHistory:function(t,e){e.stopImmediatePropagation(),this.$popup.close(),n.G.show(a.Z,{customer:t,activeTab:"account-payment"})},selectCustomer:function(t){var e=this;this.customers.forEach((function(t){return t.selected=!1})),t.selected=!0,this.isLoading=!0,POS.selectCustomer(t).then((function(s){e.isLoading=!1,e.resolveIfQueued(t)})).catch((function(t){e.isLoading=!1}))},searchCustomer:function(t){var e=this;o.ih.post("/api/nexopos/v4/customers/search",{search:t}).subscribe((function(t){t.forEach((function(t){return t.selected=!1})),e.customers=t}))},createCustomerWithMatch:function(t){this.resolveIfQueued(!1),n.G.show(a.Z,{name:t})},getRecentCustomers:function(){var t=this;this.isLoading=!0,o.ih.get("/api/nexopos/v4/customers").subscribe((function(e){t.isLoading=!1,e.forEach((function(t){return t.selected=!1})),t.customers=e}),(function(e){t.isLoading=!1}))}}};const c=(0,s(1900).Z)(i,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ns-box shadow-xl w-4/5-screen md:w-2/5-screen xl:w-108"},[s("div",{staticClass:"border-b ns-box-header text-center font-semibold text-2xl py-2",attrs:{id:"header"}},[s("h2",[t._v(t._s(t.__("Select Customer")))])]),t._v(" "),s("div",{staticClass:"relative"},[s("div",{staticClass:"p-2 border-b border-surface-tertiary flex justify-between"},[s("span",[t._v(t._s(t.__("Selected"))+" : ")]),t._v(" "),s("div",{staticClass:"flex items-center justify-between"},[s("span",[t._v(t._s(t.order.customer?t.order.customer.name:"N/A"))]),t._v(" "),t.order.customer?s("button",{staticClass:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border border-surface-secondary hover:bg-info-primary hover:text-white hover:border-transparent",on:{click:function(e){return t.openCustomerHistory(t.order.customer,e)}}},[s("i",{staticClass:"las la-eye"})]):t._e()])]),t._v(" "),s("div",{staticClass:"p-2 border-b border-surface-tertiary flex justify-between text-primary"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchCustomerValue,expression:"searchCustomerValue"}],ref:"searchField",staticClass:"rounded border-2 outline-none border-surface-primary bg-surface-quaternary w-full p-2",attrs:{placeholder:"Search Customer",type:"text"},domProps:{value:t.searchCustomerValue},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.attemptToChoose()},input:function(e){e.target.composing||(t.searchCustomerValue=e.target.value)}}})]),t._v(" "),s("div",{staticClass:"h-3/5-screen xl:h-2/5-screen overflow-y-auto"},[s("ul",[t.customers&&0===t.customers.length?s("li",{staticClass:"p-2 text-center text-primary"},[t._v("\n                    "+t._s(t.__("No customer match your query..."))+"\n                ")]):t._e(),t._v(" "),t.customers&&0===t.customers.length?s("li",{staticClass:"p-2 cursor-pointer text-center text-primary",on:{click:function(e){return t.createCustomerWithMatch(t.searchCustomerValue)}}},[s("span",{staticClass:"border-b border-dashed border-info-primary"},[t._v(t._s(t.__("Create a customer")))])]):t._e(),t._v(" "),t._l(t.customers,(function(e){return s("li",{key:e.id,staticClass:"cursor-pointer hover:bg-surface-secondary p-2 border-b border-surface-quaternary text-primary flex justify-between items-center",on:{click:function(s){return t.selectCustomer(e)}}},[s("span",[t._v(t._s(e.name))]),t._v(" "),s("p",{staticClass:"flex items-center"},[e.owe_amount>0?s("span",{staticClass:"text-error-primary"},[t._v("-"+t._s(t._f("currency")(e.owe_amount)))]):t._e(),t._v(" "),e.owe_amount>0?s("span",[t._v("/")]):t._e(),t._v(" "),s("span",{staticClass:"text-success-primary"},[t._v(t._s(t._f("currency")(e.purchases_amount)))]),t._v(" "),s("button",{staticClass:"mx-2 rounded-full h-8 w-8 flex items-center justify-center border border-surface-quaternary hover:bg-info-secondary hover:text-white hover:border-transparent",on:{click:function(s){return t.openCustomerHistory(e,s)}}},[s("i",{staticClass:"las la-eye"})])])])}))],2)]),t._v(" "),t.isLoading?s("div",{staticClass:"z-10 top-0 absolute w-full h-full flex items-center justify-center"},[s("ns-spinner",{attrs:{size:"24",border:"8"}})],1):t._e()])])}),[],!1,null,null,null).exports},7298:(t,e,s)=>{s.d(e,{Z:()=>v});var o=s(8603),r=s(9671),n=s(2242),a=s(1045),i=s(7266),c=s(7389);const u={mounted:function(){this.closeWithOverlayClicked(),this.loadTransactionFields()},data:function(){return{fields:[],isSubmiting:!1,formValidation:new i.Z}},methods:{__:c.__,closeWithOverlayClicked:o.Z,proceed:function(){var t=this,e=this.$popupParams.customer,s=this.formValidation.extractFields(this.fields);this.isSubmiting=!0,r.ih.post("/api/nexopos/v4/customers/".concat(e.id,"/account-history"),s).subscribe({next:function(e){t.isSubmiting=!1,r.kX.success(e.message).subscribe(),t.$popupParams.resolve(e),t.$popup.close()},error:function(e){t.isSubmiting=!1,r.kX.error(e.message).subscribe(),t.$popupParams.reject(e)}})},close:function(){this.$popup.close(),this.$popupParams.reject(!1)},loadTransactionFields:function(){var t=this;r.ih.get("/api/nexopos/v4/fields/ns.customers-account").subscribe({next:function(e){t.fields=t.formValidation.createFields(e)}})}}};var l=s(1900);const d=(0,l.Z)(u,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"w-6/7-screen md:w-5/7-screen lg:w-4/7-screen h-6/7-screen md:h-5/7-screen lg:h-5/7-screen overflow-hidden shadow-lg bg-surface-tertiary flex flex-col relative"},[s("div",{staticClass:"p-2 border-b border-surface-secondary flex justify-between items-center"},[s("h2",{staticClass:"font-semibold"},[t._v(t._s(t.__("New Transaction")))]),t._v(" "),s("div",[s("ns-close-button",{on:{click:function(e){return t.close()}}})],1)]),t._v(" "),s("div",{staticClass:"flex-auto overflow-y-auto"},[0===t.fields.length?s("div",{staticClass:"h-full w-full flex items-center justify-center"},[s("ns-spinner")],1):t._e(),t._v(" "),t.fields.length>0?s("div",{staticClass:"p-2"},t._l(t.fields,(function(t,e){return s("ns-field",{key:e,attrs:{field:t}})})),1):t._e()]),t._v(" "),s("div",{staticClass:"p-2 bg-surface-tertiary justify-between border-t border-surface-secondary flex"},[s("div"),t._v(" "),s("div",{staticClass:"px-1"},[s("div",{staticClass:"-mx-2 flex flex-wrap"},[s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"danger"},on:{click:function(e){return t.close()}}},[t._v(t._s(t.__("Close")))])],1),t._v(" "),s("div",{staticClass:"px-1"},[s("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.proceed()}}},[t._v(t._s(t.__("Proceed")))])],1)])])]),t._v(" "),0===t.isSubmiting?s("div",{staticClass:"h-full w-full absolute flex items-center justify-center",staticStyle:{background:"rgb(0 98 171 / 45%)"}},[s("ns-spinner")],1):t._e()])}),[],!1,null,null,null).exports;var p=s(3258),_=s(4864),f=s(6386);const m={name:"ns-pos-customers",data:function(){return{activeTab:"create-customers",customer:null,subscription:null,orders:[],options:{},optionsSubscriber:null,selectedTab:"orders",isLoadingCoupons:!1,isLoadingRewards:!1,coupons:[],rewardsResponse:[],order:null}},components:{nsPaginate:s(5834).Z},destroyed:function(){this.subscription.unsubscribe(),this.optionsSubscriber.unsubscribe()},mounted:function(){var t=this;this.closeWithOverlayClicked(),this.optionsSubscriber=POS.options.subscribe((function(e){t.options=e})),this.subscription=POS.order.subscribe((function(e){t.order=e,void 0!==t.$popupParams.customer?(t.activeTab="account-payment",t.customer=t.$popupParams.customer,t.loadCustomerOrders(t.customer.id)):void 0!==e.customer&&(t.activeTab="account-payment",t.customer=e.customer,t.loadCustomerOrders(t.customer.id))})),this.popupCloser()},methods:{__:c.__,popupResolver:f.Z,popupCloser:o.Z,getType:function(t){switch(t){case"percentage_discount":return(0,c.__)("Percentage Discount");case"flat_discount":return(0,c.__)("Flat Discount")}},closeWithOverlayClicked:o.Z,doChangeTab:function(t){this.selectedTab=t,"coupons"===t&&this.loadCoupons(),"rewards"===t&&this.loadRewards()},loadCoupons:function(){var t=this;this.isLoadingCoupons=!0,r.ih.get("/api/nexopos/v4/customers/".concat(this.customer.id,"/coupons")).subscribe({next:function(e){t.coupons=e,t.isLoadingCoupons=!1},error:function(e){t.isLoadingCoupons=!1}})},loadRewards:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/api/nexopos/v4/customers/".concat(this.customer.id,"/rewards");this.isLoadingRewards=!0,r.ih.get(e).subscribe({next:function(e){t.rewardsResponse=e,t.isLoadingRewards=!1},error:function(e){t.isLoadingRewards=!1}})},allowedForPayment:function(t){return["unpaid","partially_paid","hold"].includes(t.payment_status)},prefillForm:function(t){void 0!==this.$popupParams.name&&(t.main.value=this.$popupParams.name)},openCustomerSelection:function(){this.$popup.close(),n.G.show(a.default)},loadCustomerOrders:function(t){var e=this;r.ih.get("/api/nexopos/v4/customers/".concat(t,"/orders")).subscribe((function(t){e.orders=t}))},newTransaction:function(t){new Promise((function(e,s){n.G.show(d,{customer:t,resolve:e,reject:s})})).then((function(e){POS.loadCustomer(t.id).subscribe((function(t){POS.selectCustomer(t)}))}))},applyCoupon:function(t){var e=this;void 0===this.order.customer?n.G.show(_.default,{title:(0,c.__)("Use Customer ?"),message:(0,c.__)("No customer is selected. Would you like to proceed with this customer ?"),onAction:function(s){s&&POS.selectCustomer(e.customer).then((function(s){e.proceedApplyingCoupon(t)}))}}):this.order.customer.id===this.customer.id?this.proceedApplyingCoupon(t):this.order.customer.id!==this.customer.id&&n.G.show(_.default,{title:(0,c.__)("Change Customer ?"),message:(0,c.__)("Would you like to assign this customer to the ongoing order ?"),onAction:function(s){s&&POS.selectCustomer(e.customer).then((function(s){e.proceedApplyingCoupon(t)}))}})},proceedApplyingCoupon:function(t){var e=this;new Promise((function(e,s){n.G.show(p.default,{apply_coupon:t.code,resolve:e,reject:s})})).then((function(t){e.popupResolver(!1)})).catch((function(t){}))},handleSavedCustomer:function(t){r.kX.success(t.message).subscribe(),POS.selectCustomer(t.entry),this.$popup.close()}}};const v=(0,l.Z)(m,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"shadow-lg rounded w-95vw h-95vh lg:w-3/5-screen flex flex-col overflow-hidden",attrs:{id:"ns-pos-customers"}},[s("div",{staticClass:"ns-header p-2 flex justify-between items-center border-b"},[s("h3",{staticClass:"font-semibold"},[t._v(t._s(t.__("Customers")))]),t._v(" "),s("div",[s("ns-close-button",{on:{click:function(e){return t.$popup.close()}}})],1)]),t._v(" "),s("div",{staticClass:"ns-body flex-auto flex p-2 overflow-y-auto"},[s("ns-tabs",{attrs:{active:t.activeTab},on:{active:function(e){t.activeTab=e}}},[s("ns-tabs-item",{attrs:{identifier:"create-customers",label:"New Customer"}},["yes"===t.options.ns_pos_customers_creation_enabled?s("ns-crud-form",{attrs:{"submit-url":"/api/nexopos/v4/crud/ns.customers",src:"/api/nexopos/v4/crud/ns.customers/form-config"},on:{updated:function(e){return t.prefillForm(e)},save:function(e){return t.handleSavedCustomer(e)}},scopedSlots:t._u([{key:"title",fn:function(){return[t._v(t._s(t.__("Customer Name")))]},proxy:!0},{key:"save",fn:function(){return[t._v(t._s(t.__("Save Customer")))]},proxy:!0}],null,!1,2432171054)}):t._e(),t._v(" "),"yes"!==t.options.ns_pos_customers_creation_enabled?s("div",{staticClass:"h-full flex-col w-full flex items-center justify-center text-primary"},[s("i",{staticClass:"lar la-hand-paper ns-icon text-6xl"}),t._v(" "),s("h3",{staticClass:"font-medium text-2xl"},[t._v(t._s(t.__("Not Authorized")))]),t._v(" "),s("p",[t._v(t._s(t.__("Creating customers has been explicitly disabled from the settings.")))])]):t._e()],1),t._v(" "),s("ns-tabs-item",{staticClass:"flex",staticStyle:{padding:"0!important"},attrs:{identifier:"account-payment",label:t.__("Customer Account")}},[null===t.customer?s("div",{staticClass:"flex-auto w-full flex items-center justify-center flex-col p-4"},[s("i",{staticClass:"lar la-frown text-6xl"}),t._v(" "),s("h3",{staticClass:"font-medium text-2xl"},[t._v(t._s(t.__("No Customer Selected")))]),t._v(" "),s("p",[t._v(t._s(t.__("In order to see a customer account, you need to select one customer.")))]),t._v(" "),s("div",{staticClass:"my-2"},[s("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.openCustomerSelection()}}},[t._v(t._s(t.__("Select Customer")))])],1)]):t._e(),t._v(" "),t.customer?s("div",{staticClass:"flex flex-col flex-auto"},[s("div",{staticClass:"flex-auto p-2 flex flex-col"},[s("div",{staticClass:"-mx-4 flex flex-wrap"},[s("div",{staticClass:"px-4 mb-4 w-full"},[s("h2",{staticClass:"font-semibold"},[t._v(t._s(t.__("Summary For"))+" : "+t._s(t.customer.name))])]),t._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-success-primary to-green-700 p-2 flex flex-col text-white"},[s("h3",{staticClass:"font-medium text-lg"},[t._v(t._s(t.__("Total Purchases")))]),t._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"font-bold"},[t._v(t._s(t._f("currency")(t.customer.purchases_amount)))])])])]),t._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-error-secondary to-red-700 p-2 text-white"},[s("h3",{staticClass:"font-medium text-lg"},[t._v(t._s(t.__("Total Owed")))]),t._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"text-2xl font-bold"},[t._v(t._s(t._f("currency")(t.customer.owed_amount)))])])])]),t._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-blue-500 to-blue-700 p-2 text-white"},[s("h3",{staticClass:"font-medium text-lg"},[t._v(t._s(t.__("Account Amount")))]),t._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"text-2xl font-bold"},[t._v(t._s(t._f("currency")(t.customer.account_amount)))])])])]),t._v(" "),s("div",{staticClass:"px-4 mb-4 w-full md:w-1/4"},[s("div",{staticClass:"rounded-lg shadow bg-transparent bg-gradient-to-br from-teal-500 to-teal-700 p-2 text-white"},[s("h3",{staticClass:"font-medium text-lg"},[t._v(t._s(t.__("Credit Limit")))]),t._v(" "),s("div",{staticClass:"w-full flex justify-end"},[s("h2",{staticClass:"text-2xl font-bold"},[t._v(t._s(t._f("currency")(t.customer.credit_limit_amount)))])])])])]),t._v(" "),s("div",{staticClass:"flex flex-auto flex-col overflow-hidden"},[s("ns-tabs",{attrs:{active:t.selectedTab},on:{changeTab:function(e){return t.doChangeTab(e)}}},[s("ns-tabs-item",{attrs:{identifier:"orders",label:t.__("Orders")}},[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[t._v(t._s(t.__("Last Purchases")))])]),t._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"150"}},[t._v(t._s(t.__("Order")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[t._v(t._s(t.__("Total")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[t._v(t._s(t.__("Status")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"50"}},[t._v(t._s(t.__("Options")))])])]),t._v(" "),s("tbody",{staticClass:"text-primary"},[0===t.orders.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"4"}},[t._v(t._s(t.__("No orders...")))])]):t._e(),t._v(" "),t._l(t.orders,(function(e){return s("tr",{key:e.id},[s("td",{staticClass:"border p-2 text-center"},[t._v(t._s(e.code))]),t._v(" "),s("td",{staticClass:"border p-2 text-center"},[t._v(t._s(t._f("currency")(e.total)))]),t._v(" "),s("td",{staticClass:"border p-2 text-right"},[t._v(t._s(e.human_status))]),t._v(" "),s("td",{staticClass:"border p-2 text-center"},[t.allowedForPayment(e)?s("button",{staticClass:"hover:bg-info-primary hover:border-transparent hover:text-white rounded-full h-8 px-2 flex items-center justify-center border border-gray bg-surface-tertiary"},[s("i",{staticClass:"las la-wallet"}),t._v(" "),s("span",{staticClass:"ml-1"},[t._v(t._s(t.__("Payment")))])]):t._e()])])}))],2)])])])]),t._v(" "),s("ns-tabs-item",{attrs:{identifier:"coupons",label:t.__("Coupons")}},[t.isLoadingCoupons?s("div",{staticClass:"flex-auto h-full justify-center flex items-center"},[s("ns-spinner",{attrs:{size:"36"}})],1):t._e(),t._v(" "),t.isLoadingCoupons?t._e():[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[t._v(t._s(t.__("Coupons")))])]),t._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"150"}},[t._v(t._s(t.__("Name")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[t._v(t._s(t.__("Type")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold"})])]),t._v(" "),s("tbody",{staticClass:"text-primary text-sm"},[0===t.coupons.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"4"}},[t._v(t._s(t.__("No coupons for the selected customer...")))])]):t._e(),t._v(" "),t._l(t.coupons,(function(e){return s("tr",{key:e.id},[s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",[t._v(t._s(e.name))]),t._v(" "),s("div",{},[s("ul",{staticClass:"-mx-2 flex"},[s("li",{staticClass:"text-xs text-primary px-2"},[t._v(t._s(t.__("Usage :"))+" "+t._s(e.usage)+"/"+t._s(e.limit_usage))]),t._v(" "),s("li",{staticClass:"text-xs text-primary px-2"},[t._v(t._s(t.__("Code :"))+" "+t._s(e.code))])])])]),t._v(" "),s("td",{staticClass:"border p-2 text-center"},[t._v(t._s(t.getType(e.coupon.type))+" \n                                                                "),"percentage_discount"===e.coupon.type?s("span",[t._v("\n                                                                    ("+t._s(e.coupon.discount_value)+"%)\n                                                                ")]):t._e(),t._v(" "),"flat_discount"===e.coupon.type?s("span",[t._v("\n                                                                    ("+t._s(t._f("currency")(e.coupon.discount_value))+")\n                                                                ")]):t._e()]),t._v(" "),s("td",{staticClass:"border p-2 text-right"},[s("ns-button",{attrs:{type:"info"},on:{click:function(s){return t.applyCoupon(e)}}},[t._v(t._s(t.__("Use Coupon")))])],1)])}))],2)])])])]],2),t._v(" "),s("ns-tabs-item",{attrs:{identifier:"rewards",label:t.__("Rewards")}},[t.isLoadingRewards?s("div",{staticClass:"flex-auto h-full justify-center flex items-center"},[s("ns-spinner",{attrs:{size:"36"}})],1):t._e(),t._v(" "),t.isLoadingRewards?t._e():[s("div",{staticClass:"py-2 w-full"},[s("h2",{staticClass:"font-semibold text-primary"},[t._v(t._s(t.__("Rewards")))])]),t._v(" "),s("div",{staticClass:"flex-auto flex-col flex overflow-hidden"},[s("div",{staticClass:"flex-auto overflow-y-auto"},[s("table",{staticClass:"table ns-table w-full"},[s("thead",[s("tr",{staticClass:"text-primary"},[s("th",{staticClass:"p-2 border font-semibold",attrs:{width:"150"}},[t._v(t._s(t.__("Name")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[t._v(t._s(t.__("Points")))]),t._v(" "),s("th",{staticClass:"p-2 border font-semibold"},[t._v(t._s(t.__("Target")))])])]),t._v(" "),t.rewardsResponse.data?s("tbody",{staticClass:"text-primary text-sm"},[0===t.rewardsResponse.data.length?s("tr",[s("td",{staticClass:"border p-2 text-center",attrs:{colspan:"4"}},[t._v(t._s(t.__("No rewards available the selected customer...")))])]):t._e(),t._v(" "),t._l(t.rewardsResponse.data,(function(e){return s("tr",{key:e.id},[s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",{staticClass:"text-center"},[t._v(t._s(e.reward_name))])]),t._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",{staticClass:"text-center"},[t._v(t._s(e.points))])]),t._v(" "),s("td",{staticClass:"border p-2",attrs:{width:"300"}},[s("h3",{staticClass:"text-center"},[t._v(t._s(e.target))])])])}))],2):t._e()])])]),t._v(" "),s("div",{staticClass:"py-1 flex justify-end"},[s("ns-paginate",{attrs:{pagination:t.rewardsResponse},on:{load:function(e){return t.loadRewards(e)}}})],1)]],2)],1)],1)]),t._v(" "),s("div",{staticClass:"p-2 border-t border-surface-secondary flex justify-between"},[s("div"),t._v(" "),s("div",[s("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.newTransaction(t.customer)}}},[t._v(t._s(t.__("Account Transaction")))])],1)])]):t._e()])],1)],1)])}),[],!1,null,null,null).exports}}]);